# 07 数据库设计

**数据库设计**是指对于一个给定的应用环境，构造（设计）优化的数据库逻辑模式和物理结构，并据此建立数据库及其应用系统，使之能够有效地存储和管理数据，满足各种用户的应用需求。

信息管理要求：在数据库中应该存储和管理哪些数据对象。

数据操作要求：对数据对象需要进行哪些操作，如查询、增、删、改、统计等操作。

**数据库设计的目标**是为用户和各种应用系统提供一个信息基础设施和高效率的运行环境。

高效率的运行环境

数据库数据的存取效率高

数据库存储空间的利用率高

数据库系统运行管理的效率高

**数据库设计阶段**

1. 需求分析

2. 概念结构设计

3. 逻辑结构设计

4. 物理结构设计

5. 数据库实施

6. 数据库运行和维护

需求分析和概念设计独立于任何数据库管理系统

逻辑设计和物理设计与选用的数据库管理系统密切相关

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-00-26-31-image.png)

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-00-26-49-image.png)

<img src="file:///C:/Users/Polaris/AppData/Roaming/marktext/images/9a823e0a23dcee1604b06eb1a0d33fea6e987a18.png" title="" alt="QQ截图20230612002715.png" width="486">

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-00-34-18-image.png)

需求分析阶段：综合各个用户的应用需求

概念设计阶段：

形成独立于机器特点，独立于各个数据库管理系统产品的概念模式（E-R图）

逻辑设计阶段：

1. 首先将E-R图转换成具体的数据库产品支持的数据模型，如关系模型，

形成数据库逻辑模式

2. 然后根据用户处理的要求、安全性的考虑，在基本表的基础上再建立

必要的视图（View），形成数据的外模式

物理设计阶段：

根据数据库管理系统特点和处理的需要，进行物理存储安排，建立索引，形成数据库内模式

## 需求分析

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-00-35-12-image.png)

## 数据字典

数据字典是关于数据库中数据的描述，即元数据，不是数据本身

数据字典在需求分析阶段建立，在数据库设计过程中不断修改、充实、完善

数据字典是进行详细的数据收集和数据分析所获得的主要结果

数据字典的内容

1. 数据项（不可再分的数据单位）
   
   1. 数据项描述={数据项名,数据项含义说明,别名,数据类型,长度,取值范围,取值含义,与其他数据项的逻辑关系,数据项之间的联系}

2. 数据结构(反映数据之间的组合关系)
   
   1. 数据结构描述={数据结构名，含义说明，组成:{数据项或数据结构}}

3. 数据流(数据结构在系统内传输的路径)
   
   1. 数据流描述={数据流名,说明,数据流来源,数据流去向,组成:{数据结构},平均流量,高峰期流量}

4. 数据存储(数据结构停留或保存的地方，也是数据流的来源和去向之一)
   
   1. 数据存储描述={数据存储名,说明,编号,输的数据流 , 输出的数据流, 组成:{数据结构},数据量, 存取频度,存取方式}

5. 处理过程(一般用判定表或判定树来描述)
   
   1.     处理过程描述={处理过程名,说明,输入:{数据流},  输出:{数据流},处理:{简要说明}}

数据项是数据的最小组成单位

若干个数据项可以组成一个数据结构

数据字典通过对数据项和数据结构的定义来描述数据流、数据存储的逻辑内容

## 概念模型

##### E-R图

![image-20220615202421868.png](C:\Users\Polaris\AppData\Roaming\marktext\images\6057e7edfeed8cef8c7d55deaee2f54073f75c29.png)

##### ISA联系

有的实体型是某个实体型的子类型，这种父类-子类联系称为ISA联系，表示“is a”语义。用△表示。性质: 子类继承了父类的所有属性，子类也可以有自己的属性。

分类属性是父实体型的一个属性

分类属性的值把父实体型中的实体分派到子实体型中

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-11-16-55-image.png)

不相交约束：描述父类中的一个实体不能同时属于多个子类中的实体集。即-一个父类中的实体最多属于一个子类实体集。用ISA联系符号三角形的-一个叉号“X"来表示。

可重叠约束:父类中的一个实体能同时属于多个子类中的实体集。子类符号中没有叉号表示是可重叠的。

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-11-17-34-image.png)

描述父类中的一个实体是否必须是某一个子类中的实体。如果是，则叫做完全特化( total specialization )否则叫做部分特化( partial specialization)

完全特化用父类到子类的双线连接来表示

部分特化用父类到子类的单线连接来表示

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-11-18-12-image.png)

##### 基数约束

说明实体型中的任何一个实体可以在联系中出现的最少次数和最多次数。

用 min..max表示，0 ≤ min ≤ max。例如，0..1， 1..3， 1.. \*，, 其中 \*代表无穷大。

min=1的约束叫做强制参与约束，即被施加基数约束的实体型中的每个实体都要参与联系;

min=0的约束叫做非强制参与约束，被施加基数约束的实体型中的实体可以出现在联系中，也可以不出现在联系

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-11-20-23-image.png)

##### Part-of 联系

描述某个实体型是另外一个实体型的一部分。

Part-of 联系可以分为两种情况:

1. 非独占的Part-of联系，简称非独占联系

2. 整体实体如果被破坏，另一部分实体仍然可以独立存在

独占的Part-of联系，简称独占联系。整体实体如果被破坏，部分实体不能存在

表示：

1. 用非强制参与联系表示非独占的Part-of联系

2. 用弱实体类型和识别联系来表示独占联系编号编号

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-11-22-04-image.png)

##### 弱实体型和独占联系

如果一个实体型的存在依赖其它实体型的存在，则这个实体型为弱实体型,否则为强实体型。

用弱实体类型和识别联系来表示独占联系双矩形表示弱实体型，用双菱型表示识别联系。

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-11-22-45-image.png)

## 概念结构设计

方法：自顶向下、自底向上、逐步扩张、混合策略

## 实体与属性的划分

两条准则：

1. 作为属性，不能再具有需要描述的性质。属性是不可分的数据项，不能包含其他属性。

2. 属性不能与其他实体具有联系，即E-R图中所表示的联系是实体之间的联系。

[例1] 职工是一个实体，职工号、姓名、年龄是职工的属性。

职称如果没有与工资、福利挂钩，没有进一步描述的特性，根据准则（1）可以作为职工实体的属性。如果不同的职称有不同的工资、住房标准和不同的附加福利，则职称作为一个实体更恰当

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-11-54-43-image.png)

[例3] 如果一种货物只存放在一个仓库，那么就可以把存放货物的仓库的仓库号作为描述货物存放地点的属性。如果一种货物可以存放在多个仓库中，或者仓库本身又用面积作为属性，或者仓库与职工发生管理上的联系，那么就应把仓库作为一个实体。

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-11-55-55-image.png)

## E-R图的集成

E-R图的集成一般需要分两步

1. 合并。解决各分E-R图之间的冲突，将分E-R图合并起来生成初步E-R图。

2. 修改和重构。消除不必要的冗余，生成基本E-R图

**属性冲突**

1. 属性域冲突，即属性值的类型、取值范围或取值集合不同。
   
   1. 零件号：有的部门把它定义为整数，有的部门把它定义为字符型。
   
   2. 年龄：某些部门以出生日期形式表示职工的年龄，有的部门用整数表示。

2. 属性取值单位冲突。
   
   1. 零件的重量：有的以公斤为单位，有的以斤为单位，有的以克为单位。

**命名冲突**

1. 同名异义，即不同意义的对象在不同的局部应用中具有相同的名字。

2. 异名同义（一义多名），即同一意义的对象在不同的局部应用中具有不同的名字。
   
   1. 如对科研项目，财务科称为项目，科研处称为课题，生产管理处称为工程。

命名冲突可能发生在实体、联系一级上。也可能发生在属性一级上。

**结构冲突**

1. 同一对象在不同应用中具有不同的抽象。
   
   1. 例如，职工在某一局部应用中被当作实体，而在另一局部应用中则被当作属性。
      
      解决方法：把属性变换为实体或把实体变换为属性，使同一对象具有相同的抽象。但仍然要遵循实体与属性的划分原则。

2. 同一实体在不同子系统的E-R图中所包含的属性个数和属性排列次序不完全相同。
   
   解决方法：使该实体的属性取各子系统的E-R图中属性的并集，再适当调整属性的次序。

3. 实体间的联系在不同的E-R图中为不同的类型。
   
   实体E1与E2在一个E-R图中是多对多联系，在另一个E-R图中是一对多联系
   
   解决方法：根据应用的语义对实体联系的类型进行综合或调整。

![QQ截图20230612120517.png](C:\Users\Polaris\AppData\Roaming\marktext\images\5fc603fa6b90cbba419a73da04de1f540ac49eb3.png)

冗余数据是指可由基本数据导出的数据，冗余的联系是指可由其他联系导出的联系。

消除冗余主要采用分析方法，即以数据字典和数据流图为依据，根据数据字典中关于数据项之间逻辑关系的说明来消除冗余。

![QQ截图20230612120622.png](C:\Users\Polaris\AppData\Roaming\marktext\images\ebad236e2336f03b47e610279f0b468aab4bb6a2.png)

## 逻辑结构设计

**转换内容**

E-R图由实体型、实体的属性和实体型之间的联系三个要素组成

关系模型的逻辑结构是一组关系模式的集合

将E-R图转换为关系模型：将实体型、实体的属性和实体型之间的联系转化为关系模式

**转换原则-1:1联系**

一个1:1联系可以转换为一个独立的关系模式，也可以与任意一端对应的关系模式合并。

转换为一个独立的关系模式

1. 关系的属性：与该联系相连的各实体的码以及联系本身的属性

2. 关系的候选码：每个实体的码均是该关系的候选码

与某一端实体对应的关系模式合并

1. 合并后关系的属性：加入对应关系的码和联系本身的属性

2. 合并后关系的码：不变

**转换原则-1:n联系**

一个1:n联系可以转换为一个独立的关系模式，也可以与n端对应的关系模式合并。

转换为一个独立的关系模式

1. 关系的属性：与该联系相连的各实体的码以及联系本身的属性

2. 关系的码：n端实体的码

与n端对应的关系模式合并

1. 合并后关系的属性：在n端关系中加入1端关系的码和联系本身的属性

2. 合并后关系的码：不变

3. 可以减少系统中的关系个数

**转换原则-m:n联系**

一个m:n联系转换为一个关系模式

1. 关系的属性：与该联系相连的各实体的码以及联系本身的属性

2. 关系的码：各实体码的组合

[例]“选修”联系是一个m:n联系，可以将它转换为如下关系模式，其中学号与课程号为关系的组合码：

选修（<u><span>学号，课程号</span></u>，成绩）

**转换原则-多元联系**

三个或三个以上实体间的一个多元联系转换为一个关系模式。

1. 关系的属性：与该多元联系相连的各实体的码以及联系本身的属性

2. 关系的码：各实体码的组合

**转换原则-关系模式的合并**

具有相同码的关系模式可合并

目的：减少系统中的关系个数

合并方法：

1. 将其中一个关系模式的全部属性加入到另一个关系模式中

2. 然后去掉其中的同义属性（可能同名也可能不同名）

3. 适当调整属性的次序

![](C:\Users\Polaris\AppData\Roaming\marktext\images\2023-06-12-12-12-15-image.png)

部门（<u><span>部门号</span></u>，部门名，经理的职工号，…）

职工（<u><span>职工号</span></u>、部门号，职工名，职务，…）

产品（<u><span>产品号</span></u>，产品名，产品组长的职工号，…）

供应商（<u><span>供应商号</span></u>，姓名，…）

零件（<u><span>零件号</span></u>，零件名，…）

参加（<u><span>职工号，产品号</span></u>，工作天数，…）

供应（<u><span>产品号，供应商号，零件号</span></u>，供应量）

## 关系模式的分解

对关系模式进行必要分解，提高数据操作效率和存储空间的利用率。

**水平分解**

把(基本)关系的元组分为若干子集合，定义每个子集合为一个子关系，以提高系统的效率。

如何分解

1. 对符合“80/20原则”的，把经常被使用的数据（约20%）水平分解出来，形成一个子关系。

2. 水平分解为若干子关系，使每个事务存取的数据对应一个子关系。

**垂直分解**

适用范围：取决于分解后R上的所有事务的总效率是否得到了提高

分解方法

1. 简单情况：直观分解

2. 复杂情况：用模式分解算法
   
   垂直分解必须不损失关系模式的语义（保持无损连接性和保持函数依赖）

##### 设计用户子模式

定义数据库模式主要是从系统的时间效率、空间效率、易维护等角度出发。

定义用户外模式：

1. 使用更符合用户习惯的别名

2. 针对不同级别的用户定义不同的视图，以保证系统的安全性

3. 简化用户对系统的使用

##### 数据库管理系统适应性转换

一般的数据模型还需要向特定数据库管理系统规定的模型进行转换。

转换的主要依据是所选用的数据库管理系统的功能及限制。没有通用规则。

对于关系模型来说，这种转换通常都比较简单。

## 物理结构设计

数据库物理设计的步骤

1. 确定数据库的物理结构，在关系数据库中主要指存取方法和存储结构;

2. 对物理结构进行评价，评价的重点是时间和空间效率

设计物理数据库结构的准备工作

1. 充分了解应用环境，详细分析要运行的事务，以获得选择物理数据库设计所需参数。

2. 充分了解所用关系型数据库管理系统的内部特征，特别是系统提供的存取方法和存储结构。

关系数据库物理设计的内容

1. 为关系模式选择存取方法

2. 设计关系、索引等数据库文件的物理存储结构

物理数据库设计所需参数

1. 数据库查询事务
   
   1. 查询的关系
   
   2. 查询条件所涉及的属性
   
   3. 连接条件所涉及的属性
   
   4. 查询的投影属性

2. 数据更新事务
   
   1. 被更新的关系
   
   2. 每个关系上的更新操作条件所涉及的属性
   
   3. 修改操作要改变的属性值

3. 每个事务在各关系上运行的频率和性能要求

数据库管理系统常用存取方法

1. B+树索引存取方法

2. Hash索引存取方法

3. 聚簇存取方法

##### B+树

选择索引存取方法的主要内容：根据应用要求确定

1. 对哪些属性列建立索引

2. 对哪些属性列建立组合索引

3. 对哪些索引要设计为唯一索引

选择索引存取方法的一般规则：

1. 如果一个（或一组）属性经常在查询条件中出现，则考虑在这个（或这组）属性上建立索引（或组合索引）

2. 如果一个属性经常作为最大值和最小值等聚集函数的参数，则考虑在这个属性上建立索引

3. 如果一个（或一组）属性经常在连接操作的连接条件中出现，则考虑在这个（或这组）属性上建立索引

关系上定义的索引数过多会带来较多的额外开销（维护、查找索引的开销)

##### Hash

选择Hash存取方法的规则

如果一个关系的属性主要出现在等值连接条件中或主要出现在等值比较选择条件中，而且满足下列两个条件之一

1. 该关系的大小可预知，而且不变；

2. 该关系的大小动态改变，但所选用的数据库管理系统提供了动态Hash存取方法。

##### 聚簇

为了提高某个属性（或属性组）的查询速度，把这个或这些属性（称为聚簇码）上具有相同值的元组集中存放在连续的物理块中称为聚簇。

该属性（或属性组）称为聚簇码（cluster key）

聚簇的用途：大大提高按聚簇属性进行查询的效率

```sql
[例] 假设学生关系按所在系建有索引，现在要查询信息系的所有学生名单。
计算机系的500名学生分布在500个不同的物理块上时，至少要执行500次I/O操作。
如果将同一系的学生元组集中存放，
则每读一个物理块可得到多个满足查询条件的元组，
从而显著地减少了访问磁盘的次数。
```

既适用于单个关系独立聚簇,

也适用于经常进行连接操作的多个关系

1. 把多个连接的元组按连接属性值聚集存放

2. 从而实现多个关系的“预连接”，提高连接操作的效率。

选择聚簇存储方法，即确定需要建立多少个聚簇，每个聚簇中包含哪些关系

1. 一个数据库可以建立多个聚簇，一个关系只能加入一个聚簇。

设计候选聚簇

1. 常在一起进行连接操作的关系可以建立组合聚簇

2. 如果一个关系的一组属性经常出现在相等比较条件中，则该单个关系可建立聚簇；

3. 如果一个关系的一个（或一组）属性上的值重复率很高，则此单个关系可建立聚簇。

检查候选聚簇中的关系，取消其中不必要的关系

1. 从聚簇中删除经常进行全表扫描的关系

2. 从聚簇中删除更新操作远多于连接操作的关系

3. 从聚簇中删除重复出现的关系
   
   1. 当一个关系同时加入多个聚簇时，必须从这多个聚簇方案（包括不建立聚簇）中选择一个较优的，即在这个聚簇上运行各种事务的总代价最小。

局限性

1. 聚簇只能提高某些特定应用的性能

2. 建立与维护聚簇的开销相当大
   
   1. 对已有关系建立聚簇，将导致关系中元组的物理存储位置移动，并使此关系上原有的所有索引无效，必须重建。
   
   2. 当一个元组的聚簇码改变时，该元组的存储位置也要做相应改变。

当通过聚簇码进行访问或连接是该关系的主要应用，与聚簇码无关的其他访问很少或者是次要的时，可以使用聚簇

1. 尤其当SQL语句中包含有与聚簇码有关的ORDER BY, GROUP BY, UNION,
   DISTINCT等子句或短语时，使用聚簇特别有利，可以省去或减化对结果集的排序操作

**确定数据库的存储结构**

确定关系、索引、聚簇、日志、备份等的存储安排和存储结构，确定系统配置

影响因素：硬件环境、应用需求（存取时间、存储空间利用率、维护代价）

**确定数据的存放位置**

基本原则：

根据应用将易变部分与稳定部分分开存放、经常存取部分与存取频率较低部分分开存放

**确定系统配置**

数据库管理系统一般都提供了一些存储分配参数：

同时使用数据库的用户数

同时打开的数据库对象数

内存分配参数

缓冲区分配参数（使用的缓冲区长度、个数）

存储分配参数

物理块的大小

物理块装填因子

时间片大小

数据库的大小

锁的数目等

**评价物理结构**

评价方法：定量估算各种方案存储空间、存取时间、维护代价

## 数据库的实施和维护

1. 数据载入和应用程序的调试
   
   1. 人工方法
   
   2. 计算机辅助数据入库
      
      数据库应用程序的设计应该与数据设计并行进行
      
      在组织数据入库的同时还要调试应用程序

2. 数据库的试运行
   
   1. 功能测试：实际运行应用程序，执行对数据库的各种操作，测试应用程序的各种功能。
   
   2. 性能测试：测量系统的性能指标，分析是否符合设计目标。

3. 数据库的运行和维护
   
   1. 数据库的转储和恢复
   
   2. 数据库的安全性、完整性控制
   
   3. 数据库性能的监督、分析和改进
   
   4. 数据库的重组织与重构造

4. 数据库的转储和恢复
   
   1. 制定不同的转储计划，定期对数据库和日志文件进行备份

5. 数据库的安全性、完整性控制
   
   1. 初始定义
   
   2. 修改定义

6. 数据库性能的监督、分析和改进
   
   1. 监督系统运行，对监测数据进行分析，找出改进系统性能的方法

7. 数据库的重组织
   
   1. 增加或删除某些数据项
   
   2. 改变数据项的类型
   
   3. 增加或删除某个表
   
   4. 改变数据库的容量
   
   5. 增加或删除某些索引

8. 数据库的重构造
   
   1. 重构造数据库的程度是有限的
